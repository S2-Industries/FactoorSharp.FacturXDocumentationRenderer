<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FacturX 1.0.7</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <!-- Google Fonts: Inter for a modern, highly readable font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Minimal custom CSS for functionality and specific adjustments -->
    <style>
        /* CSS variables for sidebar width for easy adjustment and JS control */
        :root {
            --sidebar-width: 350px; /* Default sidebar width */
            --sidebar-min-width: 200px; /* Minimum width */
            --sidebar-max-width: 500px; /* Maximum width */
            /* Global font size can be adjusted here, e.g. --bs-body-font-size: 0.95rem; */
        }

        :root {
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-black: #000;
            --bs-white: #fff;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --bs-gray-100: #f8f9fa;
            --bs-gray-200: #e9ecef;
            --bs-gray-300: #dee2e6;
            --bs-gray-400: #ced4da;
            --bs-gray-500: #adb5bd;
            --bs-gray-600: #6c757d;
            --bs-gray-700: #495057;
            --bs-gray-800: #343a40;
            --bs-gray-900: #212529;
            /* Context colors, derived from above */
            --bs-primary: var(--bs-blue);
            --bs-secondary: var(--bs-gray-600);
            --bs-success: var(--bs-green);
            --bs-info: var(--bs-cyan);
            --bs-warning: var(--bs-yellow);
            --bs-danger: var(--bs-red);
            --bs-light: var(--bs-gray-100);
            --bs-dark: var(--bs-gray-900);
            /* Backtround, text etc. */
            --bs-body-color: #212529;
            --bs-body-bg: #fff;
            /* Subtle colors */
            --bs-primary-bg-subtle: #cfe2ff;
            --bs-secondary-bg-subtle: #e2e3e5;
            --bs-success-bg-subtle: #d1e7dd;
            --bs-info-bg-subtle: #cff4fc;
            --bs-warning-bg-subtle: #fff3cd;
            --bs-danger-bg-subtle: #f8d7da;
            --bs-light-bg-subtle: #fcfcfd;
            --bs-dark-bg-subtle: #ced4da;
            --bs-primary-text-emphasis: #052c65;
            --bs-secondary-text-emphasis: #2b2f32;
            --bs-success-text-emphasis: #0a3622;
            --bs-info-text-emphasis: #055160;
            --bs-warning-text-emphasis: #664d03;
            --bs-danger-text-emphasis: #58151c;
            --bs-light-text-emphasis: #495057;
            --bs-dark-text-emphasis: #161719;
            --bs-primary-border-subtle: #9ec5fe;
            --bs-secondary-border-subtle: #c4c8cb;
            --bs-success-border-subtle: #a3cfbb;
            --bs-info-border-subtle: #9eeaf9;
            --bs-warning-border-subtle: #ffe69c;
            --bs-danger-border-subtle: #f1aeb5;
            --bs-light-border-subtle: #e9ecef;
            --bs-dark-border-subtle: #adb5bd;
        }

        html { /* Set font-family globally */
            font-family: 'Inter', sans-serif;
        }

        body {
            display: flex; /* Flexbox for side-by-side layout */
            height: 100vh; /* Minimum height of the body is the full viewport height */
            overflow: hidden; /* Prevents scrollbars on the body; inner areas will scroll */
            /* Subtle elegant gradient for the background */           
            background: radial-gradient(75% 75% at 25% 25%, rgba(13,110,253,.08), transparent), linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        }

        #sidebar {
            width: var(--sidebar-width); /* Sidebar width controlled by CSS variable */
            position: relative; /* Important for the resizer */
            transition: width 0.1s ease-out; /* Smooth transition during resizing */
            /* Subtle shadow on the right side */
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        #resizer {
            width: 8px; /* Width of the drag handle */
            height: 100%;
            position: absolute;
            right: 0;
            top: 0;
            cursor: ew-resize; /* Cursor change when dragging */
            z-index: 10;
            background-color: transparent; /* Invisible but interactive */
        }

        #content-area {
            /* Specific padding value, no direct Bootstrap utility for this precision */
            padding: 2.5rem;
        }

        /* General link styling within tree-view */
        .tree-view a {
            position: relative; /* For pseudo-element positioning */
            z-index: 0; /* Ensure text and icon are above ::before */
            display: block;
            text-decoration: none;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--bs-body-color);
            /* Base padding for all links to provide consistent click area and space */
            padding: var(--bs-spacer-y, 0.25rem) 4px; /* py-1 and left/right 4px padding */
            transition: color 0.2s; /* Only text color transitions */
        }

            /* Pseudo-element for fill effect */
            .tree-view a::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 0; /* Initial state: no fill */
                background-color: rgba(var(--bs-primary-rgb), 0.1); /* Light primary color background */
                z-index: -1; /* Place behind the link text/icon */
                border-radius: inherit; /* Inherit border-radius from parent a */
            }

            .tree-view a:hover {
                color: var(--bs-primary); /* Text color on hover */
            }

            .tree-view a.active {
                color: white !important; /* Primary text color when active */
                font-weight: 600; /* Bold text when active */
            }

            /* Active state for the pseudo-element */
            .tree-view a.active::before {
                width: 100%; /* Fill the entire width when active */
                background-color: rgb(11, 94, 215);                
            }

            /* Styling for the expand/collapse chevron */
            .toggle-icon {
                transition: transform 0.2s ease-in-out; /* Smooth rotation */
                cursor: pointer;
                /* Padding for the icon's click area */
                padding: var(--bs-spacer-y, 0.25rem) var(--bs-spacer-x, 0.5rem); /* py-1 px-2 */
                line-height: 1; /* Ensure vertical alignment */
                flex-shrink: 0; /* Prevents the icon from shrinking when text wraps */
            }

            .toggle-icon.rotated {
                transform: rotate(90deg); /* Rotates the icon when it's opened */
            }

        .fs-7 {
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="m-0 d-flex flex-column" style="height:100vh;">

    <div id="layout-wrapper" class="d-flex flex-grow-1 overflow-hidden">
        <!-- Bootstrap: m-0 for margin-0 -->
        <!-- Left sidebar for the tree view -->
        <aside id="sidebar" class="flex-shrink-0 bg-white overflow-auto py-4 mb-4 mt-4">
            <div id="sidebar-header" class="px-4 pb-3 border-bottom border-light mb-3">
                <h4 class="mb-0 text-primary">FacturX elements</h4>
            </div>
            <nav class="flex-grow-1 tree-view">
                <ul class="list-unstyled mb-0" />
            </nav>
            <!-- Drag handle to change the sidebar width -->
            <div id="resizer"></div>
        </aside>

        <!-- Main content area -->
        <main id="content-area" class="flex-grow-1 overflow-y-auto bg-white rounded-3 m-4 shadow">
            <h1 id="element-name" class="fw-bold text-dark mb-4 pb-3 border-bottom border-secondary-subtle">WÃ¤hle ein Element aus</h1>
            <p class="lead text-muted" id="initial-message">
                Please select an element frmo the tree.
            </p>

            <div id="element-details" class="d-none">
                <dl class="row">
                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">ID</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-id"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">XPath</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-xpath"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Description</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-description"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Cardinality</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-cardinality"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Business Rule</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-business-rule"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Business Term</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-business-term"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Profiles</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-profile-support">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Minimum</th>
                                    <th>Basic</th>
                                    <th>Basic WL</th>
                                    <th>Comfort (EN16931)</th>
                                    <th>Extended</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="ps-minimum"></td>
                                    <td id="ps-basic"></td>
                                    <td id="ps-basicwl"></td>
                                    <td id="ps-en16931"></td>
                                    <td id="ps-extended"></td>
                                </tr>
                            </tbody>
                        </table>

                    </dd>
                </dl>
            </div>
        </main>
    </div>

    <footer class="text-center text-muted mb-3 small">
        Generated with <a href="https://github.com/S2-Industries/FactoorSharp.FacturXDocumentationRenderer">FacturX Documentation Renderer</a> <i class="bi bi-github"></i>
    </footer>

    <!-- Bootstrap 5 JavaScript-Bundle (Popper.js for popups included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
    <script>
        // Get DOM elements
        const sidebar = document.getElementById('sidebar');
        const resizer = document.getElementById('resizer');
        const contentArea = document.getElementById('content-area');
        const elementDetailsDiv = document.getElementById('element-details');
        const elementNameHeading = document.getElementById('element-name');
        const initialMessage = document.getElementById('initial-message');
        const detailDescription = document.getElementById('detail-description');
        const detailCardinality = document.getElementById('detail-cardinality');
        const detailBusinessRule = document.getElementById('detail-business-rule');
        const detailBusinessTerm = document.getElementById('detail-business-term');
        const detailProfileSupport = document.getElementById('detail-profile-support');
        const detailId = document.getElementById('detail-id');
        const detailXPath = document.getElementById('detail-xpath');

        // Selector for links starting with '#elem-' to capture content links only
        const treeLinks = document.querySelectorAll('.tree-view a[href^="#elem-"]');

        // Sample data for ZUGFeRD elements (IDs updated to 'elem-X')
        const elementData = {};

        // --- Logic for resizing the sidebar ---
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'ew-resize'; // Change cursor
            sidebar.style.userSelect = 'none'; // Prevent text selection while dragging
            sidebar.style.pointerEvents = 'none'; // Prevent interaction with sidebar content
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            let newWidth = e.clientX; // New width based on mouse position
            const minWidth = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-min-width'));
            const maxWidth = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-max-width'));

            // Keep width within min/max bounds
            if (newWidth < minWidth) newWidth = minWidth;
            if (newWidth > maxWidth) newWidth = maxWidth;

            document.documentElement.style.setProperty('--sidebar-width', `${newWidth}px`);
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.cursor = 'default'; // Reset cursor
            sidebar.style.userSelect = ''; // Allow text selection again
            sidebar.style.pointerEvents = ''; // Allow interaction with sidebar content again
        });

        // --- Logic for displaying content and deep links ---
        function updateContent(elementKey) {
            const data = elementData[elementKey]; // Retrieve data for the selected element

            // Set all links to "inactive"
            treeLinks.forEach(link => link.classList.remove('active'));

            if (data) {
                // Update content elements
                elementNameHeading.textContent = data.name;
                detailDescription.textContent = data.description;
                detailBusinessTerm.textContent = data.businessTerm;
                detailBusinessRule.textContent = data.businessRule;
                detailCardinality.textContent = data.cardinality;
                detailId.textContent = data.id;
                detailXPath.textContent = data.xpath;

                // fill profile table
                const profiles = [
                    "MINIMUM",
                    "BASIC",
                    "BASICWL",
                    "EN16931",
                    "EXTENDED"
                ];

                profiles.forEach(p => {
                    const hasProfile = data.profileSupport.includes(`|${p}|`);
                    document.getElementById(`ps-${p.toLowerCase()}`).textContent = hasProfile ? "X" : "";
                });

                elementDetailsDiv.classList.remove('d-none'); // Show details
                initialMessage.classList.add('d-none'); // Hide original message

                // Highlight active link in the sidebar
                const activeLink = document.querySelector(`.tree-view a[href="#${elementKey}"]`);
                if (activeLink) {
                    activeLink.classList.add('active'); // Adds the CSS class 'active'

                    // Deep link: Expand all parent elements of the active link
                    let currentUl = activeLink.closest('ul.collapse');
                    while (currentUl) {
                        if (!currentUl.classList.contains('show')) {
                            // Get or create Bootstrap Collapse instance and show it
                            const bsCollapse = bootstrap.Collapse.getInstance(currentUl) || new bootstrap.Collapse(currentUl, { toggle: false });
                            bsCollapse.show(); // Trigger Bootstrap's show method
                        }
                        // Move up to the next parent UL that is also collapsible
                        currentUl = currentUl.parentElement.closest('ul.collapse');
                    }
                    activeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } else {
                // If no element is found (e.g. invalid hash), reset to initial state
                elementNameHeading.textContent = 'Select an element from the tree';
                initialMessage.classList.remove('d-none');
                elementDetailsDiv.classList.add('d-none');
            }
        }

        // Event listener for clicks on the tree links
        treeLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default behavior (direct jump)
                const elementKey = link.getAttribute('href').substring(1); // Extract element key from the hash
                updateContent(elementKey); // Update content
                window.location.hash = elementKey; // Update URL hash for deep linking
            });
        });

        // Event listener for the chevrons' expand/collapse function
        document.querySelectorAll('.toggle-icon').forEach(icon => {
            const targetId = icon.getAttribute('data-bs-target');
            if (!targetId) return;

            const collapseElement = document.querySelector(targetId);
            if (!collapseElement) return;

            collapseElement.addEventListener('show.bs.collapse', (e) => {
                if (e.target !== collapseElement) return; // <<< WICHTIG
                icon.classList.add('rotated');
            });

            collapseElement.addEventListener('hide.bs.collapse', (e) => {
                if (e.target !== collapseElement) return; // <<< WICHTIG
                icon.classList.remove('rotated');
            });

            // initial state
            if (collapseElement.classList.contains('show')) {
                icon.classList.add('rotated');
            }
        });

        // Function to handle hash changes (for deep links and first load)
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // Get hash without '#'
            if (hash) {
                updateContent(hash); // Update content based on hash
            } else {
                updateContent(null); // Reset to initial state when no hash present
            }
        }

        // Listener for hash changes in the URL
        window.addEventListener('hashchange', handleHashChange);
        // Initial call on page load to support deep links
        window.addEventListener('load', handleHashChange);
    </script>
</body>
</html>