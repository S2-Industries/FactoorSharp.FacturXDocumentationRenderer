    <div id="layout-wrapper" class="d-flex flex-grow-1 overflow-hidden">
        <!-- Bootstrap: m-0 for margin-0 -->
        <!-- Left sidebar for the tree view -->
        <aside id="sidebar" class="flex-shrink-0 bg-white overflow-auto py-4 mb-4 mt-4">
            <div id="sidebar-header" class="mb-2 px-4 pb-2 border-bottom border-light mb-3">
                <h3 class="mb-0 text-primary">FacturX</h3>
                <ul class="list-unstyled">
                    <li>
                        <a href="./bt-elements.html" class="link-underline link-underline-opacity-0" alt="BT elements">BT Elements</a>
                    </li>
                </ul>
            </div>

            <div id="sidebar-header" class="px-4 pb-1 border-bottom border-light mb-3">
                <h4 class="mb-0 text-primary">FacturX structure</h4>
            </div>
            <nav class="flex-grow-1 tree-view">
                {{TREEVIEW_DATA}}
            </nav>
            <!-- Drag handle to change the sidebar width -->
            <div id="resizer"></div>
        </aside>

        <!-- Main content area -->
        <main id="content-area" class="flex-grow-1 overflow-y-auto bg-white rounded-3 m-4 shadow">
            <h1 id="element-name" class="fw-bold text-dark mb-4 pb-3 border-bottom border-secondary-subtle">Wähle ein Element aus</h1>
            <p class="lead text-muted" id="initial-message">
                Please select an element from the tree.
            </p>

            <div id="element-details" class="d-none">
                <dl class="row">
                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">ID</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-id"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">XPath</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-xpath"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Description</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-description"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Cardinality</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-cardinality"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Business Rule</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-business-rule"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Business Term</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-business-term"></dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2">Profiles</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 text-muted" id="detail-profile-support">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Minimum</th>
                                    <th>Basic</th>
                                    <th>Basic WL</th>
                                    <th>Comfort (EN16931)</th>
                                    <th>Extended</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="ps-minimum"></td>
                                    <td id="ps-basic"></td>
                                    <td id="ps-basicwl"></td>
                                    <td id="ps-en16931"></td>
                                    <td id="ps-extended"></td>
                                </tr>
                            </tbody>
                        </table>

                    </dd>

                    <dt class="col-sm-12 col-md-3 fw-semibold text-secondary mb-2 mt-2">Child Elements</dt>
                    <dd class="col-sm-12 col-md-9 mb-3 mt-2 text-muted">
                        <ul id="detail-children" class="list-group list-group-flush">
                        </ul>
                    </dd>
                </dl>
            </div>
        </main>
    </div>

    <script>
        // Get DOM elements
        const sidebar = document.getElementById('sidebar');
        const resizer = document.getElementById('resizer');
        const contentArea = document.getElementById('content-area');
        const elementDetailsDiv = document.getElementById('element-details');
        const elementNameHeading = document.getElementById('element-name');
        const initialMessage = document.getElementById('initial-message');
        const detailDescription = document.getElementById('detail-description');
        const detailCardinality = document.getElementById('detail-cardinality');
        const detailBusinessRule = document.getElementById('detail-business-rule');
        const detailBusinessTerm = document.getElementById('detail-business-term');
        const detailProfileSupport = document.getElementById('detail-profile-support');
        const detailId = document.getElementById('detail-id');
        const detailXPath = document.getElementById('detail-xpath');
        const detailChildren = document.getElementById('detail-children');

        // Sample data for ZUGFeRD elements
        {{ELEMENT_DATA}}

        // --- Logic for resizing the sidebar ---
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'ew-resize'; // Change cursor
            sidebar.style.userSelect = 'none'; // Prevent text selection while dragging
            sidebar.style.pointerEvents = 'none'; // Prevent interaction with sidebar content
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            let newWidth = e.clientX; // New width based on mouse position
            const minWidth = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-min-width'));
            const maxWidth = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-max-width'));

            // Keep width within min/max bounds
            if (newWidth < minWidth) newWidth = minWidth;
            if (newWidth > maxWidth) newWidth = maxWidth;

            document.documentElement.style.setProperty('--sidebar-width', `${newWidth}px`);
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.cursor = 'default'; // Reset cursor
            sidebar.style.userSelect = ''; // Allow text selection again
            sidebar.style.pointerEvents = ''; // Allow interaction with sidebar content again
        });

        // --- Logic for displaying content and deep links ---
        function updateContent(elementKey) {
            const data = elementData[elementKey]; // Retrieve data for the selected element

            // Set all links to "inactive"
            document.querySelectorAll('.tree-view a.element-link').forEach(link => link.classList.remove('active'));

            if (data) {
                // Update content elements
                elementNameHeading.textContent = data.name;
                detailDescription.textContent = data.description;
                detailBusinessTerm.textContent = data.businessTerm;
                detailBusinessRule.textContent = data.businessRule;
                detailCardinality.textContent = data.cardinality;
                detailId.textContent = data.id;
                detailXPath.textContent = data.xpath;

                // fill profile table
                const profiles = [
                    "MINIMUM",
                    "BASIC",
                    "BASICWL",
                    "EN16931",
                    "EXTENDED"
                ];

                profiles.forEach(p => {
                    const hasProfile = data.profileSupport.includes(`|${p}|`);
                    document.getElementById(`ps-${p.toLowerCase()}`).textContent = hasProfile ? "X" : "";
                });

                // Display child elements
                detailChildren.innerHTML = '';
                if (data.children && data.children.length > 0) {
                    data.children.forEach(child => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item list-group-item-action p-2';
                        
                        const link = document.createElement('a');
                        link.href = `#${child.elementId}`;
                        link.textContent = child.name;
                        link.className = 'text-decoration-none';
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            updateContent(child.elementId);
                            window.location.hash = child.elementId;
                        });
                        
                        li.appendChild(link);
                        detailChildren.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.className = 'list-group-item p-2 text-muted fst-italic';
                    li.textContent = 'No child elements';
                    detailChildren.appendChild(li);
                }

                elementDetailsDiv.classList.remove('d-none'); // Show details
                initialMessage.classList.add('d-none'); // Hide original message

                // Highlight active link in the sidebar and expand parent nodes
                const activeLink = document.querySelector(`.tree-view a.element-link[href="#${elementKey}"]`);
                if (activeLink) {
                    activeLink.classList.add('active'); // Adds the CSS class 'active'

                    // Deep link: Expand all parent elements of the active link
                    let currentUl = activeLink.closest('ul.collapse');
                    while (currentUl) {
                        if (!currentUl.classList.contains('show')) {
                            // Show the collapse without animation for deep linking
                            currentUl.classList.add('show');
                            
                            // Rotate the corresponding chevron icon
                            const collapseId = currentUl.getAttribute('id');
                            if (collapseId) {
                                const chevron = document.querySelector(`[data-bs-target="#${collapseId}"]`);
                                if (chevron) {
                                    chevron.classList.add('rotated');
                                }
                            }
                        }
                        // Move up to the next parent UL that is also collapsible
                        currentUl = currentUl.parentElement.closest('ul.collapse');
                    }
                    
                    // Scroll to the active link after a short delay to allow DOM updates
                    setTimeout(() => {
                        activeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            } else {
                // If no element is found (e.g. invalid hash), reset to initial state
                elementNameHeading.textContent = 'Select an element from the tree';
                initialMessage.classList.remove('d-none');
                elementDetailsDiv.classList.add('d-none');
            }
        } // !updateContent()

        // Initialize tree view interactions after DOM is loaded
        function initializeTreeView() {
            // Event listener for the chevrons' expand/collapse function
            document.querySelectorAll('.toggle-icon').forEach(icon => {
                const targetId = icon.getAttribute('data-bs-target');
                if (!targetId) return;

                const collapseElement = document.querySelector(targetId);
                if (!collapseElement) return;

                collapseElement.addEventListener('show.bs.collapse', (e) => {
                    if (e.target !== collapseElement) return;
                    icon.classList.add('rotated');
                });

                collapseElement.addEventListener('hide.bs.collapse', (e) => {
                    if (e.target !== collapseElement) return;
                    icon.classList.remove('rotated');
                });

                // Set initial state
                if (collapseElement.classList.contains('show')) {
                    icon.classList.add('rotated');
                }
            });

            // Click handlers for tree links
            document.querySelectorAll('.tree-view a.element-link').forEach(link => {
                const parentLi = link.closest('li');
                if (!parentLi) return;

                const childUl = parentLi.querySelector(':scope > ul.collapse');
                const hasChildren = !!childUl;

                link.addEventListener('click', e => {
                    e.preventDefault();
                    
                    const elementKey = link.getAttribute('href').substring(1);
                    
                    // If element has children, toggle expansion
                    if (hasChildren) {
                        const collapse = bootstrap.Collapse.getOrCreateInstance(childUl, { toggle: false });
                        collapse.toggle();
                    }
                    
                    // Always navigate to the element
                    updateContent(elementKey);
                    window.location.hash = elementKey;
                });
            });
        } // !initializeTreeView()

        // Function to handle hash changes (for deep links and first load)
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // Get hash without '#'
            if (hash) {
                updateContent(hash); // Update content based on hash
            } else {
                updateContent(null); // Reset to initial state when no hash present
            }
        } // !handleHashChange()

        // Listener for hash changes in the URL
        window.addEventListener('hashchange', handleHashChange);
        
        // Initial setup on page load
        window.addEventListener('load', () => {
            initializeTreeView();
            handleHashChange();
        });
    </script>
